# AWR使用時の注意点

AWRは非常に有用なツールですが、使用する際にはいくつかの注意点があります。

## 1. リソース消費

AWRのデータ収集自体がシステムに負担をかけることがあります。

- **注意**: 頻繁なデータ収集は全体の性能に影響する可能性があります。
- **対策**: 通常は1時間間隔が適切ですが、状況に応じて調整しましょう。

```sql
-- スナップショット間隔の変更（例：2時間に1回）
BEGIN
  DBMS_WORKLOAD_REPOSITORY.MODIFY_SNAPSHOT_SETTINGS(
    interval => 7200
  );
END;
/
```

## 2. ストレージ使用量

AWRデータはSYSAUXテーブルスペースに保存されるため、長期間のデータ保持は大量のストレージを消費する可能性があります。

- **注意点**: SYSAUXテーブルスペースが肥大化し、ディスク容量を圧迫する可能性があります。
- **対策**: 
  1. 定期的にSYSAUXの使用状況を確認する
  2. 必要に応じて保持期間を調整する

```sql
-- SYSAUXの使用状況確認
SELECT tablespace_name, used_space, tablespace_size
FROM dba_tablespace_usage_metrics
WHERE tablespace_name = 'SYSAUX';
```

## 3. セキュリティとプライバシー

AWRにはセンシティブな情報（例：SQLテキスト、オブジェクト名）が含まれている可能性があります。

- **注意点**: AWRレポートを外部と共有する際、機密情報が漏洩するリスクがあります。
- **対策**: 
  1. AWRレポートへのアクセスを制限する
  2. 外部共有前にレポートをレビューし、必要に応じて機密情報を編集する

## 4. 解釈の誤り

AWRデータの誤った解釈は、不適切なチューニング決定につながる可能性があります。

- **注意点**: 単一のAWRレポートだけでパフォーマンス問題を判断すると、誤った結論に至る可能性があります。
- **対策**: 
  1. 複数の期間のAWRレポートを比較分析する
  2. AWRデータと他の情報源（アプリケーションログ、OSレベルの監視など）を組み合わせて総合的に判断する

## 5. AWRの限界

AWRは万能ではありません。

- データベース外の問題（ネットワーク遅延など）は捉えられない
- 非常に短時間の問題は見逃す可能性がある
- データの解釈には経験が必要

## 実践的ヒント

- 定期的にAWRレポートをチェックし、長期的な傾向を把握する
- 問題発生時は、直前と平常時のレポートを比較する
- AWRデータと実際のユーザー体験を常に照らし合わせる

AWRは強力な「診断ツール」ですが、使い方を誤ると「誤診」につながります。常に慎重に、そして複数の視点からデータを解釈することが重要です。
