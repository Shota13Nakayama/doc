# AWR (Automatic Workload Repository) Overview

AWRは、Oracleデータベースの性能を監視し、問題を診断するためのツールです。

## AWRとは？

AWRは、データベースの動作状況やパフォーマンスに関する様々な統計情報を定期的に収集し、保存する仕組みです。これらのデータは、データベース管理者（DBA）がパフォーマンスの問題を特定し、解決するのに役立ちます。

これは、車の走行データを記録するドライブレコーダーのようなものと考えられます。

## AWRの主な特徴

1. **自動データ収集**: デフォルトでは1時間ごとにデータを記録（スナップショット）
2. **データ保持**: 標準で8日間のデータ:スナップショットを保存（設定変更可能）
3. **幅広い情報**: CPU使用率、I/O統計、SQL実行統計など
4. **AWRレポート生成**: 収集したデータを基に詳細なパフォーマンスレポートを作成可能（保存されているスナップショットを利用してレポートを作成可能）

## AWRの重要性

1. **パフォーマンス問題の特定**: 過去の正常時と問題発生時のデータを比較し、異常を検出
2. **トレンド分析**: 長期的なパフォーマンスの変化を追跡
3. **キャパシティプランニング**: リソース使用率の傾向を分析し、将来の需要を予測

## 具体例

例えば、毎日深夜3時にバッチ処理を実行しているシステムで、先週から処理時間が2倍になったとします。AWRを使用すれば、以下のような分析が可能です：

1. 先週と今週の深夜3時のAWRスナップショットを比較
2. CPU使用率、ディスクI/O、実行されたSQLなどの違いを確認
3. 問題の原因（例：特定のSQLの実行計画変更）を特定

AWRは、データベースの「健康診断書」のようなものです。
定期的にチェックすることで、問題の早期発見と対策が可能になります。

## AWRレポートの解析方法について

AWRレポートは非常に多岐にわたる情報を出力します。
ここで、問題が起きた際、問題が起きた期間のAWRレポートを見るだけではなく、問題がないAWRレポートと比べることを強く意識してください。
AWRレポート１つだけで問題を発見する（絶対評価）ことは非常に難易度が高いですが、問題がないときのAWRレポートと問題があるAWRレポートを比較することで状態の差分を発見することが可能となり、難易度がぐっと下がります。

解析の良い例：
***単体性能試験***：とあるバッチが流れたときに、「遅延が発生したAWRレポート」と「遅延が発生していないときのAWRレポート」を比較。

***定期的なレポート運用***：維持保守中のとある期間に障害が発生したときに、「同じような状態である期間のAWRレポートと比較」を実施

解析の悪い例：
***単性能試験***：まったく別のバッチが実行されているAWRレポートを比較
→流れているSQLなどが異なるためそもそも比較することができず、問題発見が困難。

***絶対評価***：障害が起きた際、障害が起きたときのAWRレポートだけで調査
→健康な時にどういう状態かがわからないため、何が悪いのかわかりづらい。
→「明らかにSQL時間が長い」「明らかにMemoryIOではなくDISKIOばかりに時間をとられている」など非常に簡単なレベルでの情報解析は可能。
