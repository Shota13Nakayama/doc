# Oracle-Multitenant-CDB-PDB 注意ガイド

Oracle Multitenantアーキテクチャは、複数のデータベースを一つのコンテナデータベース（CDB）内にホストすることを可能にする機能です。このガイドでは、特に初心者が陥りやすい注意点や一般的なミスについて説明します。

## 注意点

### 1. **CDBとPDBの違いを理解する**
CDB（コンテナデータベース）とPDB（プラガブルデータベース）には明確な違いがあります。CDBは全体の枠組みを提供するコンテナであり、その中に複数のPDBが格納されます。PDBは実際のユーザーデータベースとして機能します。これらを混同しないように注意してください。

### 2. **PDBの接続設定**
PDBへの接続にはTNS（Transparent Network Substrate）エントリの設定が必要です。TNSエントリが正しく設定されていない場合、PDBに接続できないことがあります。例えば、以下のようにTNSエントリを設定します：

```plaintext
PDB1 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = your_host)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = pdb1_service_name)
    )
  )
```

### 3. **PDBの起動と停止**
PDBは個別に起動・停止できます。CDBが起動していても、PDBが起動していない場合、PDBにアクセスできません。PDBを起動するには以下のコマンドを使用します：

```sql
ALTER PLUGGABLE DATABASE pdb_name OPEN;
```

停止するには：

```sql
ALTER PLUGGABLE DATABASE pdb_name CLOSE;
```

### 4. **リソース管理**
PDBごとにリソース（CPU、メモリ、I/Oなど）を管理するための設定が必要です。適切なリソース管理を怠ると、特定のPDBが他のPDBのリソースを過剰に消費する可能性があります。リソース制限を設定するには、Resource Managerを使用します。

### 5. **バックアップとリカバリ**
CDB全体のバックアップとPDB個別のバックアップは異なる方法で行います。PDBのバックアップを取る際には、RMAN（Recovery Manager）を使用して個別にバックアップすることが推奨されます。以下はRMANでPDBをバックアップする例です：

```rman
BACKUP PLUGGABLE DATABASE pdb_name;
```

### 6. **パッチ適用**
パッチ適用はCDBに対して行われますが、その影響はすべてのPDBに及びます。パッチ適用前には十分なテストを行い、必要に応じてPDBのバックアップを取っておくことが重要です。

### 7. **セキュリティと権限管理**
PDBごとに異なるユーザーと権限を設定できます。CDB管理者とPDB管理者の権限を明確に分けることで、セキュリティリスクを軽減できます。

### 8. **バージョン互換性**
CDBとPDBのバージョンが一致していることを確認してください。異なるバージョン間での互換性問題が発生する可能性があります。

## まとめ

Oracle Multitenant環境のCDBとPDBを管理する際には、上記の注意点を守ることで多くのトラブルを避けることができます。特に初心者は、これらのポイントに注意しながら設定や管理を行うことで、より安定したデータベース運用を実現できます。