# tcpdumpの使い方：初心者のためのステップバイステップガイド

## 準備

1. **tcpdumpのインストール**:
   多くのLinuxシステムでは既にインストールされていますが、もしなければ以下のコマンドでインストールできます：
   ```
   sudo apt-get install tcpdump  # Ubuntuの場合
   sudo yum install tcpdump      # CentOSの場合
   ```

2. **権限の確認**:
   tcpdumpは通常、管理者権限（root）が必要です。コマンドの前に`sudo`をつけて実行します。

## 基本的な使い方

### 1. すべてのトラフィックを見る

```
sudo tcpdump
```
このコマンドを実行すると、あなたのコンピュータを通過するすべてのネットワークトラフィックが表示されます。

出力例：
```
12:45:33.447712 IP laptop.53352 > server.http: TCP 52372:52372(0) ack 1 win 2053
```
- `12:45:33.447712`: パケットがキャプチャされた時刻
- `IP`: インターネットプロトコル（通常はこれです）
- `laptop.53352 > server.http`: 送信元（あなたのPC）から宛先（Webサーバー）へ
- `TCP`: 使用されているプロトコル

### 2. 特定のネットワークインターフェースを監視

```
sudo tcpdump -i eth0
```
`eth0`の部分は、監視したいネットワークインターフェースの名前です。
自分のインターフェース名を知るには、`ifconfig`または`ip addr`コマンドを使用します。

### 3. 特定のプロトコルのみを見る

```
sudo tcpdump tcp
```
これはTCPトラフィックのみを表示します。`udp`や`icmp`など、他のプロトコルも指定できます。

### 4. 特定のポートを監視

```
sudo tcpdump port 80
```
これはHTTP通信（通常ポート80を使用）のみを表示します。

### 5. 結果をファイルに保存

```
sudo tcpdump -w output.pcap
```
これでキャプチャしたパケットを`output.pcap`ファイルに保存します。
後で`tcpdump -r output.pcap`コマンドを使って読み取ることができます。

## 少し進んだ使い方

### 1. 送信元または宛先IPアドレスでフィルタリング

```
sudo tcpdump host 192.168.1.1
```
特定のIPアドレス（この例では192.168.1.1）との通信のみを表示します。

### 2. パケットの内容を詳しく見る

```
sudo tcpdump -X
```
キャプチャしたパケットの内容を16進数とASCII形式で表示します。

### 3. 読みやすいタイムスタンプで表示

```
sudo tcpdump -tttt
```
年月日を含む、人間が読みやすい形式でタイムスタンプを表示します。

### 4. パケット数を制限

```
sudo tcpdump -c 10
```
10パケットだけキャプチャして停止します。

## 実践的な例：HTTPトラフィックの監視

Webブラウジングのトラフィックを監視する場合：

```
sudo tcpdump -i eth0 port 80 or port 443
```
これは、eth0インターフェースのHTTP（ポート80）とHTTPS（ポート443）トラフィックを表示します。

## まとめ

tcpdumpは非常に強力なツールで、使えば使うほどネットワークへの理解が深まります。始めは基本的なコマンドから試し、徐々に複雑なフィルタリングや解析に挑戦してみてください。ネットワークトラフィックを観察することで、コンピュータ間の通信の仕組みがよりクリアに見えてくるはずです。
