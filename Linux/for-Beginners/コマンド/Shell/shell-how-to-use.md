# シェル - 使い方ガイド

## 1. シェルの基本操作

### シェルの起動
多くのLinuxディストリビューションでは、ターミナルを開くとデフォルトのシェル（多くの場合Bash）が起動します。

重要な注意点：SSHを使用してリモートサーバーに接続する際、接続が確立されると自動的にデフォルトのシェルが起動します。つまり、SSHでサーバーにログインした瞬間から、すでにシェルを使用していることになります。これは多くの初学者が気づいていない重要な点です。

```
# 特定のシェルを起動する場合
bash
zsh
fish

# リモートサーバーにSSH接続する例
ssh username@remote_server
# 接続成功後、自動的にリモートサーバーのデフォルトシェルが起動します
```

### コマンドの実行
シェルプロンプトにコマンドを入力し、Enterキーを押すことで実行します。

```
ls -l
echo "Hello, World!"
```

### コマンド履歴
上下矢印キーを使用して、以前実行したコマンドを呼び出すことができます。
```
history  # コマンド履歴を表示
!n       # 履歴のn番目のコマンドを実行
!!       # 直前のコマンドを再実行
```

## 2. 入出力のリダイレクトとパイプライン

### リダイレクト
```
command > output.txt    # 標準出力をファイルにリダイレクト（上書き）
command >> output.txt   # 標準出力をファイルにリダイレクト（追記）
command 2> error.log    # 標準エラー出力をファイルにリダイレクト
```

### パイプライン
```
command1 | command2     # command1の出力をcommand2の入力として使用
ls -l | grep ".txt"     # .txtファイルのみをリスト表示
```

## 3. 環境変数とエイリアス

### 環境変数の設定と使用
```
export VAR_NAME=value   # 環境変数を設定
echo $VAR_NAME          # 環境変数の値を表示
```

### エイリアスの作成
```
alias ll='ls -l'        # 'll'を'ls -l'のエイリアスとして設定
```

## 4. シェルスクリプトの基本

シェルスクリプトは、シェルコマンドを連続して実行するためのテキストファイルです。これにより、複雑なタスクを自動化したり、頻繁に使用するコマンドのセットを簡単に実行したりすることができます。

### シェルスクリプトの作成と実行

1. **スクリプトファイルの作成**:
   任意のテキストエディタを使用してファイルを作成します。例えば:
   ```
   nano myscript.sh
   ```

2. **シェバンの追加**:
   ファイルの先頭に、使用するシェルを指定するシェバン行を追加します:
   ```bash
   #!/bin/bash
   ```

3. **スクリプトの内容を記述**:
   実行したいコマンドを順番に記述します。例えば:
   ```bash
   #!/bin/bash
   # これはコメントです
   echo "Hello, World!"
   current_date=$(date)
   echo "現在の日時: $current_date"
   
   # ディレクトリ内のファイル数を数える
   file_count=$(ls | wc -l)
   echo "カレントディレクトリのファイル数: $file_count"
   ```

4. **ファイルの保存**:
   エディタを終了し、ファイルを保存します（nanoの場合は Ctrl+X, Y, Enter）。

5. **実行権限の付与**:
   スクリプトファイルに実行権限を付与します:
   ```
   chmod +x myscript.sh
   ```

6. **スクリプトの実行**:
   スクリプトを実行します:
   ```
   ./myscript.sh
   ```

### スクリプトの基本要素

- **変数**: 
  ```bash
  name="Alice"
  echo "Hello, $name!"
  ```

- **条件分岐**:
  ```bash
  if [ "$name" = "Alice" ]; then
      echo "Welcome, Alice!"
  else
      echo "You are not Alice."
  fi
  ```

- **ループ**:
  ```bash
  for i in 1 2 3 4 5; do
      echo "Number: $i"
  done
  ```

- **関数**:
  ```bash
  greet() {
      echo "Hello, $1!"
  }
  
  greet "World"
  ```

### スクリプトの実行方法

1. **直接実行**:
   ```
   ./myscript.sh
   ```

2. **bash コマンドを使用**:
   ```
   bash myscript.sh
   ```

3. **source コマンドを使用**:
   ```
   source myscript.sh
   ```
   または
   ```
   . myscript.sh
   ```
   (sourceを使用すると、スクリプトが現在のシェル環境で実行され、環境変数の変更などが現在のセッションに反映されます)

### スクリプト作成のベストプラクティス

1. 適切なコメントを入れて、スクリプトの目的と各部分の機能を説明する。
2. エラーハンドリングを実装し、予期しない状況に対処する。
3. 変数名は説明的で、理解しやすいものを使用する。
4. 複雑な処理は関数にまとめて、コードの可読性と再利用性を高める。
5. セキュリティを考慮し、ユーザー入力の検証やパーミッションの適切な設定を行う。

シェルスクリプトは強力なツールですが、適切に使用することが重要です。小さなスクリプトから始めて、徐々に複雑なタスクを自動化していくことをお勧めします。
## 5. シェルのカスタマイズ

### 設定ファイルの編集
```
nano ~/.bashrc          # Bashの設定ファイルを編集
source ~/.bashrc        # 変更を現在のシェルに適用
```

### プロンプトのカスタマイズ
```bash
# .bashrcに以下を追加
PS1="\u@\h:\w\$ "       # ユーザー名@ホスト名:現在のディレクトリ$
```

## 6. 高度な機能

### タブ補完
コマンドや引数を入力する際、Tabキーを押すと自動補完されます。

### ジョブ制御
```
command &               # コマンドをバックグラウンドで実行
Ctrl+Z                  # 実行中のコマンドを一時停止
bg                      # 停止したジョブをバックグラウンドで再開
fg                      # バックグラウンドジョブをフォアグラウンドに移動
```

## 注意点

1. **シェルの選択**: システムのデフォルトシェルを変更する場合は、互換性の問題が発生する可能性があることに注意してください。

2. **エスケープ処理**: 特殊文字を含む文字列を扱う際は、適切にエスケープ処理を行ってください。
